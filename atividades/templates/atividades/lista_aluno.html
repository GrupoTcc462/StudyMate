<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atividades - StudyMate</title>
    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: rgb(178, 34, 34);
            --primary-dark: rgb(222, 30, 53);
            --background: rgb(43, 45, 66);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            min-height: 100vh;
            color: #2c2c2c;
        }

        .header {
            background: rgb(237, 242, 244);
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto;
            max-width: 1200px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .nav a,
        .nav button {
            background: var(--primary);
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(178, 34, 34, 0.3);
            display: inline-block;
            border: none;
            font-size: 1rem;
            cursor: pointer;
        }

        .nav a:hover,
        .nav button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(178, 34, 34, 0.4);
            color: white;
        }

        .nav a.active,
        .nav button.active {
            background: var(--primary-dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .section-nav {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            display: flex;
            justify-content: center;
        }

        .btn-section {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-section:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            color: white;
        }

        /* FILTROS RECONSTRU√çDOS */
        .filters-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .filters-section h4 {
            color: #2c2c2c;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .filter-group select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.95rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn-filter,
        .btn-clear {
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.95rem;
        }

        .btn-filter {
            background: var(--primary);
            color: white;
        }

        .btn-filter:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-clear {
            background: #6c757d;
            color: white;
            text-decoration: none;
        }

        .btn-clear:hover {
            background: #5a6268;
            transform: translateY(-2px);
            color: white;
        }

        /* MENSAGEM "NENHUMA ATIVIDADE ENCONTRADA" */
        .empty-state {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            margin: 30px 0;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: #6c757d;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: #adb5bd;
            font-size: 1rem;
        }

        .atividade-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

        .atividade-card:hover {
            transform: translateY(-5px);
        }

        .atividade-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .atividade-titulo {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c2c2c;
            margin-bottom: 10px;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-atividade {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-prova {
            background: #fff3cd;
            color: #856404;
        }

        .badge-aviso {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-nao-vista {
            background: #dc3545;
            color: white;
        }

        .status-vista {
            background: #ffc107;
            color: #000;
        }

        .status-enviada {
            background: #28a745;
            color: white;
        }

        .atividade-info {
            margin: 15px 0;
            color: #6c757d;
        }

        .btn-acao {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }

        .btn-ver {
            background: var(--primary);
            color: white;
        }

        .btn-ver:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            color: white;
        }

        .btn-salvar {
            background: #17a2b8;
            color: white;
        }

        .btn-salvar.salva {
            background: #6c757d;
        }

        .create-first-activity {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .create-first-activity h3 {
            color: #6c757d;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .btn-create-first {
            background: #28a745;
            color: white;
            padding: 15px 35px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
           
            transition: all 0.3s ease;
        }

        .btn-create-first:hover {
            transform: translateY(-3px);
            
        }

        footer {
            background: rgb(178, 34, 34);
            color: white;
            border-radius: 20px;
            padding: 40px;
            margin-top: 30px;
            text-align: center;
        }

        footer p {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container1" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
        <div class="header">
            <img src="{% static 'study/img/logoStudyMate.png' %}" height="144px" width="293">
            <h4>Atividades Acad√™micas</h4>
            
            <div class="nav">
                <a href="{% url 'study:home' %}">üè† Home</a>
                <a href="{% url 'materias:home' %}" class="nav-btn">üìö Mat√©rias</a>
                <a href="{% url 'atividades:lista' %}" class="active">üìã Atividades</a>
                <a href="{% url 'notes:list' %}">üìù Notes</a>
                <a href="{% url 'horarios:home' %}">üïê Hor√°rios</a>

                {% if user.is_authenticated %}
                    <a href="{% url 'perfil:perfil' %}">üë§ Perfil</a>
                {% else %}
                    <a href="{% url 'accounts:login' %}">üîê Login</a>
                {% endif %}
            </div>
        </div>

        <div class="container">
            <!-- BOT√ÉO IR PARA CHAT -->
            <div class="section-nav">
                <a href="{% url 'chat:lista' %}" class="btn-section">
                     Ir para Chat
                </a>
            </div>

            <!-- BOT√ÉO CRIAR ATIVIDADE (APENAS PROFESSORES) -->
            {% if user.user_type == 'professor' or user.is_staff %}
                {% if not atividades_anotadas %}
                    <div class="create-first-activity">
                        <h3>üìö Nenhuma atividade criada ainda</h3>
                        <button class="btn-create-first" data-bs-toggle="modal" data-bs-target="#criarAtividadeModal">
                             Criar minha primeira atividade
                        </button>
                    </div>
                {% else %}
                    <div style="text-align: center; margin-bottom: 25px;">
                        <button class="btn-create-first" data-bs-toggle="modal" data-bs-target="#criarAtividadeModal">
                             Criar nova atividade
                        </button>
                    </div>
                {% endif %}
            {% endif %}

            <!-- FILTROS RECONSTRU√çDOS (IGUAL AO NOTES) -->
            <div class="filters-section">
                <h4>üîç Filtros</h4>
                <form method="get" id="filterForm">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>Tipo da atividade</label>
                            <select name="tipo" class="form-select">
                                <option value="">Todos os tipos</option>
                                <option value="ATIVIDADE" {% if filtro_tipo == 'ATIVIDADE' %}selected{% endif %}>Atividade/Tarefa</option>
                                <option value="AVISO_PROVA" {% if filtro_tipo == 'AVISO_PROVA' %}selected{% endif %}>Aviso de Prova</option>
                                <option value="AVISO_SIMPLES" {% if filtro_tipo == 'AVISO_SIMPLES' %}selected{% endif %}>Aviso Simples</option>
                            </select>
                        </div>

                        {% if user.user_type == 'aluno' %}
                        <div class="filter-group">
                            <label>Status</label>
                            <select name="status" class="form-select">
                                <option value="">Todos</option>
                                <option value="pendentes" {% if filtro_status == 'pendentes' %}selected{% endif %}>Pendentes</option>
                                <option value="enviadas" {% if filtro_status == 'enviadas' %}selected{% endif %}>Enviadas</option>
                                <option value="abertas" {% if filtro_status == 'abertas' %}selected{% endif %}>Em aberto</option>
                            </select>
                        </div>
                        {% endif %}

                        <div class="filter-group">
                            <label>Ordena√ß√£o</label>
                            <select name="order" class="form-select">
                                <option value="recent" {% if filtro_order == 'recent' %}selected{% endif %}>Mais recentes</option>
                                <option value="views" {% if filtro_order == 'views' %}selected{% endif %}>Mais visualizados</option>
                                <option value="deadline" {% if filtro_order == 'deadline' %}selected{% endif %}>Prazo mais curto</option>
                                {% if user.user_type == 'aluno' %}
                                <option value="saved" {% if filtro_order == 'saved' %}selected{% endif %}>Atividades Salvas</option>
                                {% endif %}
                            </select>
                        </div>
                    </div>

                    <div class="filter-actions">
                        <button type="submit" class="btn-filter"> Filtrar</button>
                        <a href="{% url 'atividades:lista' %}" class="btn-clear"> Limpar Filtros</a>
                    </div>
                </form>
            </div>

            <!-- LISTA DE ATIVIDADES -->
            {% if atividades_anotadas %}
                {% for item in atividades_anotadas %}
                    <div class="atividade-card">
                        <div class="atividade-header">
                            <div>
                                <h3 class="atividade-titulo">
                                    {% if not item.visualizou %}
                                        üî¥
                                    {% elif item.envio %}
                                        üü¢
                                    {% else %}
                                        üü†
                                    {% endif %}
                                    {{ item.atividade.titulo }}
                                </h3>
                                <span class="badge {% if item.atividade.tipo == 'ATIVIDADE' %}badge-atividade{% elif item.atividade.tipo == 'AVISO_PROVA' %}badge-prova{% else %}badge-aviso{% endif %}">
                                    {{ item.atividade.get_tipo_display }}
                                </span>
                            </div>
                            <div>
                                {% if not item.visualizou %}
                                    <span class="status-badge status-nao-vista">N√£o Vista</span>
                                {% elif item.envio %}
                                    <span class="status-badge status-enviada">Enviada</span>
                                {% else %}
                                    <span class="status-badge status-vista">Vista</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="atividade-info">
                            <p><strong>Professor(a):</strong> {{ item.atividade.professor.username }}</p>
                            <p><strong>Destinado:</strong> {{ item.atividade.get_anos_destino_display }}</p>
                            {% if item.atividade.prazo_entrega %}
                                <p><strong>üìÖ Prazo:</strong> {{ item.atividade.prazo_entrega|date:"d/m/Y at√© H:i" }}</p>
                            {% endif %}
                            <p><strong>üìÜ Criado:</strong> {{ item.atividade.criado_em|date:"d/m/Y √†s H:i" }}</p>
                        </div>

                        <div>
                            <a href="{% url 'atividades:detalhe' item.atividade.pk %}" class="btn-acao btn-ver">Ver Atividade</a>
                            
                            {% if user.user_type == 'aluno' %}
                            <button class="btn-acao btn-salvar {% if item.salvou %}salva{% endif %}" 
                                    onclick="salvarAtividade({{ item.atividade.pk }}, this)">
                                {% if item.salvou %}‚òÖ Salva{% else %}‚òÜ Salvar{% endif %}
                            </button>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <!-- MENSAGEM "NENHUMA ATIVIDADE ENCONTRADA" -->
                <div class="empty-state">
                    <div class="empty-state-icon">üìö</div>
                    <h3>Nenhuma atividade encontrada</h3>
                    <p>Tente ajustar os filtros ou limpar a busca.</p>
                </div>
            {% endif %}
        </div>

        <footer style="
            background: rgb(178, 34, 34);
            color: white;
            border-radius: 20px;
            padding: 40px;
            margin-top: 30px;
            text-align: center;
        ">
            <!-- ENDERE√áO: Clique para abrir no Google Maps -->
            <p style="margin-bottom: 10px;">
                <strong>Endere√ßo:</strong> 
                <a href="https://maps.app.goo.gl/dj6vG36bioJgcc2x8" 
                target="_blank" 
                rel="noopener noreferrer"
                style="
                    color: white; 
                    text-decoration: none; 
                    cursor: pointer;
                    transition: opacity 0.3s ease;
                "
                onmouseover="this.style.opacity='0.8'"
                onmouseout="this.style.opacity='1'">
                    Av. Paulo Lacerda Quartim Barbosa, 630 - Santa B√°rbara, Itapira - SP, 13977-175
                </a>
            </p>

            <!-- TELEFONE: Clique para copiar -->
            <p style="margin-bottom: 10px;">
                <strong>Telefone:</strong> 
                <span onclick="copiarTelefone()" 
                    style="
                        color: white; 
                        cursor: pointer;
                        transition: opacity 0.3s ease;
                    "
                    onmouseover="this.style.opacity='0.8'"
                    onmouseout="this.style.opacity='1'">
                    (19) 3843-1171
                </span>
            </p>

            <br>

            <!-- COPYRIGHT: Clique para ir ao site da ETEC -->
            <p style="margin: 0;">
                <a href="https://www.etecitapira.com.br/" 
                target="_blank" 
                rel="noopener noreferrer"
                style="
                    color: white; 
                    text-decoration: none; 
                    cursor: pointer;
                    transition: opacity 0.3s ease;
                "
                onmouseover="this.style.opacity='0.8'"
                onmouseout="this.style.opacity='1'">
                    &copy; 2025 ETEC Jo√£o Maria Stevanatto. Todos os direitos reservados.
                </a>
            </p>
        </footer>
    </div>

    <!-- MODAL CRIAR ATIVIDADE -->
    {% if user.user_type == 'professor' or user.is_staff %}
    <div class="modal fade" id="criarAtividadeModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: var(--primary); color: white;">
                    <h5 class="modal-title">üìù Criar Nova Atividade</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form method="POST" enctype="multipart/form-data" id="criarAtividadeForm">
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="titulo" class="form-label" style="font-weight: 600;">T√≠tulo da Atividade </label>
                            <input type="text" id="titulo" name="titulo" class="form-control" 
                                   maxlength="50" placeholder="Ex: Trabalho de Hist√≥ria" required>
                            <div class="char-counter" id="tituloCount" style="text-align: right; font-size: 0.875rem; color: #6c757d;">0/50</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" style="font-weight: 600;">Qual o Tipo de Conte√∫do? </label>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="tipo" value="ATIVIDADE" 
                                           id="tipo1" required>
                                    <label class="form-check-label" for="tipo1">üìù Atividade / Tarefa</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="tipo" value="AVISO_PROVA" 
                                           id="tipo2">
                                    <label class="form-check-label" for="tipo2">üìã Aviso de Prova</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="tipo" value="AVISO_SIMPLES" 
                                           id="tipo3">
                                    <label class="form-check-label" for="tipo3">üì¢ Aviso Simples</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3" id="prazoContainer" style="display: none;">
                            <label for="prazo" class="form-label" style="font-weight: 600;">‚è≥ Prazo de Entrega</label>
                            <input type="datetime-local" id="prazo" name="prazo_entrega" class="form-control">
                            <small class="text-muted">M√≠nimo 30 minutos ap√≥s agora</small>
                        </div>

                        <div class="mb-3">
                            <label for="descricao" class="form-label" style="font-weight: 600;">Descri√ß√£o / Orienta√ß√µes </label>
                            <textarea id="descricao" name="descricao" class="form-control" rows="4" 
                                      placeholder="Descreva a atividade..." required></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" style="font-weight: 600;">Destinado para </label>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                <div class="form-check">
                                    <input type="checkbox" name="ano_1" id="ano1" class="form-check-input">
                                    <label for="ano1" class="form-check-label">1¬∫ Ano</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" name="ano_2" id="ano2" class="form-check-input">
                                    <label for="ano2" class="form-check-label">2¬∫ Ano</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" name="ano_3" id="ano3" class="form-check-input">
                                    <label for="ano3" class="form-check-label">3¬∫ Ano</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" name="todos" id="todos" class="form-check-input">
                                    <label for="todos" class="form-check-label">Todos</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="anexo" class="form-label" style="font-weight: 600;">üìÇ Anexo (opcional)</label>
                            <input type="file" id="anexo" name="anexo" class="form-control" 
                                   accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.zip">
                            <small class="text-muted">M√°ximo 10MB</small>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary" id="btnCriar" 
                                    style="background: var(--primary); border: none;">
                                Salvar atividade
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function copiarTelefone() {
        const telefone = '(19) 3843-1171';
        
        // Criar elemento tempor√°rio
        const tempInput = document.createElement('input');
        tempInput.value = telefone;
        document.body.appendChild(tempInput);
        
        // Selecionar e copiar
        tempInput.select();
        tempInput.setSelectionRange(0, 99999); // Para mobile
        
        try {
            document.execCommand('copy');
            
            // Mostrar notifica√ß√£o de sucesso
            mostrarNotificacao('üìã Telefone copiado: ' + telefone);
        } catch (err) {
            console.error('Erro ao copiar:', err);
            mostrarNotificacao('‚ùå Erro ao copiar telefone', 'error');
        }
        
        // Remover elemento tempor√°rio
        document.body.removeChild(tempInput);
        }
        
        function mostrarNotificacao(mensagem, tipo = 'success') {
            // Verificar se j√° existe uma notifica√ß√£o
            const existente = document.getElementById('footer-notification');
            if (existente) {
                existente.remove();
            }
            
            const notificacao = document.createElement('div');
            notificacao.id = 'footer-notification';
            notificacao.textContent = mensagem;
            notificacao.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: white;
                color: #2c2c2c;
                border-left: 4px solid #28a745;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 9999;
                font-size: 0.95rem;
                animation: slideInUp 0.3s ease;
            `;
            
            document.body.appendChild(notificacao);
            
            // Remover ap√≥s 2 segundos
            setTimeout(() => {
                notificacao.style.animation = 'slideOutDown 0.3s ease';
                setTimeout(() => notificacao.remove(), 300);
            }, 2000);
        }
        
        // Adicionar anima√ß√µes CSS
        if (!document.getElementById('footer-animations')) {
            const style = document.createElement('style');
            style.id = 'footer-animations';
            style.textContent = `
                @keyframes slideInUp {
                    from {
                        transform: translateY(100px);
                        opacity: 0;
                    }
                    to {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }
                
                @keyframes slideOutDown {
                    from {
                        transform: translateY(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateY(100px);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        const csrfToken = '{{ csrf_token }}';

        // CONTADOR DE CARACTERES
        const titulo = document.getElementById('titulo');
        const tituloCount = document.getElementById('tituloCount');

        if (titulo && tituloCount) {
            titulo.addEventListener('input', function() {
                tituloCount.textContent = `${this.value.length}/50`;
                
                const regex = /^[A-Za-z√Ä-√ø√á√ß\s]*$/;
                if (!regex.test(this.value)) {
                    this.value = this.value.replace(/[^A-Za-z√Ä-√ø√á√ß\s]/g, '');
                }
            });
        }

        // MOSTRAR CAMPO DE PRAZO CONFORME TIPO
        const tipoRadios = document.querySelectorAll('input[name="tipo"]');
        const prazoContainer = document.getElementById('prazoContainer');

        if (tipoRadios && prazoContainer) {
            tipoRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'ATIVIDADE' || this.value === 'AVISO_PROVA') {
                        prazoContainer.style.display = 'block';
                    } else {
                        prazoContainer.style.display = 'none';
                        const prazoInput = document.getElementById('prazo');
                        if (prazoInput) prazoInput.value = '';
                    }
                });
            });
        }

        // VALIDA√á√ÉO CHECKBOX "TODOS"
        const todosCheck = document.getElementById('todos');
        const anosChecks = [
            document.getElementById('ano1'),
            document.getElementById('ano2'),
            document.getElementById('ano3')
        ];

        if (todosCheck && anosChecks.every(c => c)) {
            todosCheck.addEventListener('change', function() {
                if (this.checked) {
                    anosChecks.forEach(check => check.checked = false);
                }
            });

            anosChecks.forEach(check => {
                check.addEventListener('change', function() {
                    if (this.checked) {
                        todosCheck.checked = false;
                    }
                });
            });
        }

        // SALVAR ATIVIDADE
        async function salvarAtividade(atividadeId, button) {
            try {
                const response = await fetch(`/atividades/${atividadeId}/salvar/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    if (data.action === 'saved') {
                        button.classList.add('salva');
                        button.textContent = '‚òÖ Salva';
                    } else {
                        button.classList.remove('salva');
                        button.textContent = '‚òÜ Salvar';
                    }
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao salvar atividade.');
            }
        }
    </script>
</body>
</html>